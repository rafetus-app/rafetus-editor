<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rafetus Editor</title>

  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>

  <style>
    body { margin:0; background:#fff; }
    #toolbar{
      position:sticky; top:0; z-index:10;
      background:#fafafa; border-bottom:1px solid #e5e5e5;
      padding:6px; display:flex; gap:6px; flex-wrap:wrap;
      align-items:center;
    }
    #editor { padding:16px; min-height: calc(100vh - 48px); box-sizing:border-box; }
    .ql-container { font-size:16px; line-height:1.7; }
  </style>
</head>

<body>
  <div id="toolbar">
    <select class="ql-header">
      <option selected></option>
      <option value="1">H1</option>
      <option value="2">H2</option>
    </select>
    <button class="ql-bold"></button>
    <button class="ql-italic"></button>
    <button class="ql-blockquote"></button>
    <button class="ql-list" value="bullet"></button>
    <button class="ql-image"></button>
    <button class="ql-clean"></button>
  </div>

  <div id="editor"></div>

  <script>
    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: { toolbar: '#toolbar' },
      placeholder: 'Write your reflection…'
    });

    function normalizedHtml() {
      const text = quill.getText().trim();
      if (!text) return '';
      return quill.root.innerHTML;
    }

    // Flutter -> Web
    window.setContent = (html) => {
      const s = (html ?? '').toString();
      if (!s.trim()) { quill.setText(''); return; }
      const delta = quill.clipboard.convert(s);
      quill.setContents(delta);
    };

    // Web -> Flutter (app sẽ gọi getContent qua JS evaluate)
    window.getContent = () => normalizedHtml();

    // Handshake: báo Flutter "sẵn sàng"
    window.flutter_inappwebview?.callHandler('editorReady');
  </script>
</body>
</html>
